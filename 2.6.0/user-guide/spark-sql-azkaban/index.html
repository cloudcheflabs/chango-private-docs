
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cloudcheflabs.github.io/chango-private-docs/2.6.0/user-guide/spark-sql-azkaban/">
      
      
        <link rel="prev" href="../trino-azkaban/">
      
      
        <link rel="next" href="../azkaban-user-management/">
      
      <link rel="icon" href="../../images/chango-logo.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Run Spark SQL ETL Jobs with Azkaban - Chango</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

<!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=AW-419279658"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'AW-419279658'); </script>

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#run-spark-sql-etl-jobs-with-azkaban" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Chango" class="md-header__button md-logo" aria-label="Chango" data-md-component="logo">
      
  <img src="../../images/chango-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chango
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Run Spark SQL ETL Jobs with Azkaban
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../intro/intro/" class="md-tabs__link">
        What is Chango?
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../install/install-admin/" class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../features/rbac/" class="md-tabs__link">
        Features
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../cred/" class="md-tabs__link md-tabs__link--active">
        User Guide
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../components/components/" class="md-tabs__link">
        Components
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Chango" class="md-nav__button md-logo" aria-label="Chango" data-md-component="logo">
      
  <img src="../../images/chango-logo.png" alt="logo">

    </a>
    Chango
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          What is Chango?
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          What is Chango?
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/intro/" class="md-nav__link">
        What is Chango?
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/install-admin/" class="md-nav__link">
        Install Chango Admin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/install-component/" class="md-nav__link">
        Install Chango Components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/run-first-ctas/" class="md-nav__link">
        Run First Trino Query
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../install/load-external-files/" class="md-nav__link">
        Load Your Files to Iceberg Tables
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../features/rbac/" class="md-nav__link">
        Storage Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../features/catalog/" class="md-nav__link">
        Data Catalog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../features/ingestion/" class="md-nav__link">
        Data Ingestion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../features/realtime/" class="md-nav__link">
        Realtime Analytics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../features/trino-gw/" class="md-nav__link">
        Trino Gateway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../features/transform/" class="md-nav__link">
        Data Transformation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../features/query-audit/" class="md-nav__link">
        Query Audit
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cred/" class="md-nav__link">
        Get Chango Credential
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../s3-cred/" class="md-nav__link">
        Get S3 Credential
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../load-files/" class="md-nav__link">
        Load Files to Iceberg Tables using SQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../streaming/" class="md-nav__link">
        Send Streaming Events
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upload/" class="md-nav__link">
        Upload Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upload-excel/" class="md-nav__link">
        Upload Excel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connect-trino-gw/" class="md-nav__link">
        Connect to Chango Trino Gateway with Trino Clients
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rest-in-spark/" class="md-nav__link">
        Create Iceberg REST Catalog in Spark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../azkaban-cli/" class="md-nav__link">
        Create Azkaban Project using CLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark-azkaban/" class="md-nav__link">
        Run Spark Jobs with Azkaban
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trino-azkaban/" class="md-nav__link">
        Run Trino ETL Jobs with Azkaban
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Run Spark SQL ETL Jobs with Azkaban
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Run Spark SQL ETL Jobs with Azkaban
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passwordless-ssh-connection-from-azkaban-executor-nodes-to-flow-query-execution-node" class="md-nav__link">
    Passwordless SSH Connection from Azkaban Executor Nodes to Flow Query Execution Node
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-flow-of-chango-query-exec" class="md-nav__link">
    Create Flow of Chango Query Exec
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-shell-file-to-send-flow-queries-to-chango-query-exec" class="md-nav__link">
    Create Shell File to Send Flow Queries to Chango Query Exec
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-azkaban-project" class="md-nav__link">
    Create Azkaban Project
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../azkaban-user-management/" class="md-nav__link">
        Azkaban User Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kafka-topic/" class="md-nav__link">
        Create Kafka Topic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schema-reg/" class="md-nav__link">
        Configure Schema Registry URL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../chango-log/" class="md-nav__link">
        Reading Log Files Using Chango Log
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../chango-cdc/" class="md-nav__link">
        Change Data Capture Using Chango CDC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../query-exec/" class="md-nav__link">
        Data Transformation Using Chango Query Exec
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../standalone-query-exec/" class="md-nav__link">
        Data Transformation Using Standalone Chango Query Exec
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tx-streaming/" class="md-nav__link">
        Transactional Streaming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../auto-maintain-iceberg/" class="md-nav__link">
        Automatic Iceberg Table Maintenance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../maintain-iceberg/" class="md-nav__link">
        Maintain Iceberg Tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hidden-partition/" class="md-nav__link">
        Create Hidden Partitioned Iceberg Tables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../livy/" class="md-nav__link">
        Run Spark Applications using Livy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resource-group/" class="md-nav__link">
        Configure Resource Groups
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/components/" class="md-nav__link">
        Components
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="run-spark-sql-etl-jobs-with-azkaban">Run Spark SQL ETL Jobs with Azkaban</h1>
<p>Spark SQL ETL queries can be sent to <code>Chango Query Exec</code> through REST to run spark SQL ETL query jobs in <code>Chango Spark Thrift Server</code> with ease.</p>
<p><img width="900" src="../../images/user-guide/query-exec-trino-spark.png" /></p>
<p>Here, we will learn how to integrate Spark SQL ETL jobs with Azkaban workflow in Chango.</p>
<h2 id="passwordless-ssh-connection-from-azkaban-executor-nodes-to-flow-query-execution-node">Passwordless SSH Connection from Azkaban Executor Nodes to Flow Query Execution Node</h2>
<p><code>Flow Query Execution Node</code> is where all the files like flow query files, azkaban project files and query runner shell files in this example below will be created. We are going to use SSH to run remote shell files to run Spark SQL ETL jobs.
In order to access <code>Flow Query Execution Node</code> from azkaban executor nodes without password prompt, follow <a href="../../user-guide/spark-azkaban/#password-less-ssh-access-to-spark-node-from-azkaban-executor-nodes" >this instruction</a>.</p>
<h2 id="create-flow-of-chango-query-exec">Create Flow of Chango Query Exec</h2>
<p>The following is an example flow file called <code>load-parquet-to-iceberg.yaml</code> which will be sent to <code>Chango Query Exec</code> to run Saprk SQL queries through <code>Chango Spark Thrift Server</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>uri: &lt;sts-uri&gt;
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>user: &lt;sts-token&gt;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>queries:
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  - id: query-0
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    description: |-
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>      Create iceberg table if not exists.
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    depends: NONE
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    query: |-
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>      CREATE TABLE IF NOT EXISTS iceberg.iceberg_db.test_proc_import_parquet_mergeinto (
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>          orderkey BIGINT,
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>          partkey BIGINT,
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>          suppkey BIGINT,
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>          linenumber INT,
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>          quantity DOUBLE,
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>          extendedprice DOUBLE,
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>          discount DOUBLE,
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>          tax DOUBLE,
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>          returnflag STRING,
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>          linestatus STRING,
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>          shipdate DATE,
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>          commitdate DATE,
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>          receiptdate DATE,
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>          shipinstruct STRING,
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>          shipmode STRING,
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>          comment STRING)
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>      USING iceberg
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>      TBLPROPERTIES (
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>          &#39;format&#39; = &#39;iceberg/PARQUET&#39;,
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>          &#39;format-version&#39; = &#39;2&#39;,
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>          &#39;write.format.default&#39; = &#39;PARQUET&#39;,
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>          &#39;write.metadata.delete-after-commit.enabled&#39; = &#39;true&#39;,
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>          &#39;write.metadata.previous-versions-max&#39; = &#39;100&#39;,
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>          &#39;write.parquet.compression-codec&#39; = &#39;zstd&#39;)
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>  - id: query-1
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    description: |-
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>      Load parquet files in external s3 into iceberg table.
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>    depends: query-0
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    query: |-
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>      -- import parquet file in external s3 with the mode of merge.
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>      PROC iceberg.system.import (
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>          source =&gt; &#39;s3a://mykidong/temp-external-mergeinto-parquet-path/#{ nowMinusFormatted(0, 0, 1, 0, 0, 0, &quot;YYYY-MM-dd&quot;) }&#39;,
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>          s3_access_key =&gt; &#39;any-access-key&#39;,
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>          s3_secret_key =&gt; &#39;any-secret-key&#39;,
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>          s3_endpoint =&gt; &#39;any-endpoint&#39;,
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>          s3_region =&gt; &#39;any-region&#39;,
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>          file_format =&gt; &#39;parquet&#39;,
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>          action =&gt; &#39;MERGE&#39;,
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>          id_columns =&gt; &#39;orderkey,partkey,suppkey&#39;,
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>          target_table =&gt; &#39;iceberg.iceberg_db.test_proc_import_parquet_mergeinto&#39;
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>      )
</code></pre></div>
<ul>
<li><code>&lt;sts-uri&gt;</code>: URI of chango spark thrift server.</li>
<li><code>&lt;sts-token&gt;</code>: Chango credential to connect Chango Spark Thrift Server.</li>
</ul>
<p>Table <code>iceberg.iceberg_db.test_proc_import_parquet_mergeinto</code> will be created if not exists like this.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>      CREATE TABLE IF NOT EXISTS iceberg.iceberg_db.test_proc_import_parquet_mergeinto (
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>          orderkey BIGINT,
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>          partkey BIGINT,
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>          suppkey BIGINT,
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>          linenumber INT,
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>          quantity DOUBLE,
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>          extendedprice DOUBLE,
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>          discount DOUBLE,
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>          tax DOUBLE,
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>          returnflag STRING,
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>          linestatus STRING,
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>          shipdate DATE,
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>          commitdate DATE,
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>          receiptdate DATE,
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>          shipinstruct STRING,
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>          shipmode STRING,
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>          comment STRING)
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>      USING iceberg
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>      TBLPROPERTIES (
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>          &#39;format&#39; = &#39;iceberg/PARQUET&#39;,
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>          &#39;format-version&#39; = &#39;2&#39;,
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>          &#39;write.format.default&#39; = &#39;PARQUET&#39;,
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>          &#39;write.metadata.delete-after-commit.enabled&#39; = &#39;true&#39;,
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>          &#39;write.metadata.previous-versions-max&#39; = &#39;100&#39;,
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>          &#39;write.parquet.compression-codec&#39; = &#39;zstd&#39;)
</code></pre></div>
<p>After that, parquet files in external s3 will be loaded to iceberg table in Chango incrementally using <code>Chango SQL Procedure</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>      PROC iceberg.system.import (
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>          source =&gt; &#39;s3a://mykidong/temp-external-mergeinto-parquet-path/#{ nowMinusFormatted(0, 0, 1, 0, 0, 0, &quot;YYYY-MM-dd&quot;) }&#39;,
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>          s3_access_key =&gt; &#39;any-access-key&#39;,
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>          s3_secret_key =&gt; &#39;any-secret-key&#39;,
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>          s3_endpoint =&gt; &#39;any-endpoint&#39;,
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>          s3_region =&gt; &#39;any-region&#39;,
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>          file_format =&gt; &#39;parquet&#39;,
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>          action =&gt; &#39;MERGE&#39;,
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>          id_columns =&gt; &#39;orderkey,partkey,suppkey&#39;,
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>          target_table =&gt; &#39;iceberg.iceberg_db.test_proc_import_parquet_mergeinto&#39;
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>      )
</code></pre></div>
<p>Take a look at the function of <code>nowMinusFormatted(0, 0, 1, 0, 0, 0, "YYYY-MM-dd")</code> 
which will be interpreted as yesterday, for example, <code>2024-08-06</code> in <code>Chango Query Exec</code>. See <a href="../../user-guide/query-exec/">Date Functions</a> for more details.
If parquet files are saved in the path of <code>s3a://mykidong/temp-external-mergeinto-parquet-path/&lt;yyyy-MM-dd&gt;</code> everyday, the above import procedure will load parquet files from the appropriate date path.</p>
<h2 id="create-shell-file-to-send-flow-queries-to-chango-query-exec">Create Shell File to Send Flow Queries to Chango Query Exec</h2>
<p>You can send flow queries to <code>Chango Query Exec</code> simply using <code>curl</code>. 
The following is an example shell file called <code>hive-query-exec.sh</code> to send flow queries to <code>Chango Query Exec</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>#!/bin/sh
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>set -e
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>export CONFIG_PATH=NA
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>export FLOW_PATH=NA
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>for i in &quot;$@&quot;
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>do
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>case $i in
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    --config-path=*)
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    CONFIG_PATH=&quot;${i#*=}&quot;
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    shift
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    ;;
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    --flow-path=*)
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    FLOW_PATH=&quot;${i#*=}&quot;
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>    shift
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>    ;;
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    *)
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>          # unknown option
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    ;;
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>esac
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>done
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>echo &quot;CONFIG_PATH: $CONFIG_PATH&quot;
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>echo &quot;FLOW_PATH: $FLOW_PATH&quot;
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>export ACCESS_TOKEN=NA
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>export CHANGO_QUERY_EXEC_URL=NA
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a># get properties file.
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>while IFS=&#39;=&#39; read -r key value
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>do
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>    key=$(echo $key | tr &#39;.&#39; &#39;_&#39;)
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>    eval ${key}=\${value}
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>done &lt; &quot;$CONFIG_PATH&quot;
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>ACCESS_TOKEN=${accessToken}
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>CHANGO_QUERY_EXEC_URL=${changoQueryExecUrl}
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>#echo &quot;ACCESS_TOKEN: $ACCESS_TOKEN&quot;
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>echo &quot;CHANGO_QUERY_EXEC_URL: $CHANGO_QUERY_EXEC_URL&quot;
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a># request.
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>http_response=$(curl -sS -o response.txt -w &quot;%{response_code}&quot; -XPOST -H &quot;Authorization: Bearer $ACCESS_TOKEN&quot; \
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>$CHANGO_QUERY_EXEC_URL/v1/hive/exec-query-flow \
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>--data-urlencode &quot;flow=$(cat $FLOW_PATH)&quot; \
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>)
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>if [ $http_response != &quot;200&quot; ]; then
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>    echo &quot;Failed!&quot;
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>    cat response.txt
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>    exit 1;
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>else
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>    echo &quot;Succeeded.&quot;
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>    cat response.txt
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>    exit 0;
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>fi
</code></pre></div>
<p>In addition to shell file, you can create a configuration file called <code>config.properties</code> like this.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>changoQueryExecUrl=http://cp-3.chango.private:8009
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>accessToken=&lt;chango-credential&gt;
</code></pre></div>
<p>Then, you can run query exec runner shell file as follows, for example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>/home/spark/chango-etl-example/runner/hive-query-exec.sh \
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>--config-path=/home/spark/chango-etl-example/configure/config.properties \
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>--flow-path=/home/spark/chango-etl-example/etl/import/load-parquet-to-iceberg.yaml \
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>;
</code></pre></div>
<h2 id="create-azkaban-project">Create Azkaban Project</h2>
<p>You need to create flow file called <code>load.flow</code> of Azkaban like this.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>---
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>config:
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  failure.emails: admin@your-domain.com
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>nodes:
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  - name: start
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    type: noop
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>  - name: &quot;load-parquet-to-iceberg&quot;
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    type: command
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    config:
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>      command: |-
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        ssh spark@cp-1.chango.private &quot; \
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>        /home/spark/chango-etl-example/runner/hive-query-exec.sh \
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>        --config-path=/home/spark/chango-etl-example/configure/config.properties \
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>        --flow-path=/home/spark/chango-etl-example/etl/import/load-parquet-to-iceberg.yaml \
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>        ;
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>        &quot;
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    dependsOn:
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>      - start
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>  - name: end
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    type: noop
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    dependsOn:
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>      - &quot;load-parquet-to-iceberg&quot;
</code></pre></div>
<p>This azkaban flow file shows DAG to run remote shell files which send query flow to <code>Chango Query Exec</code>.</p>
<p>Create a metadata file called <code>flow20.project</code> for azkaban project.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>azkaban-flow-version: 2.0
</code></pre></div>
<blockquote>
<p>All the files here created for now should be managed by source control system like git.</p>
</blockquote>
<p>Create Azkaban project file as zip.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a># package azkaban project file.
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>zip load.zip load.flow flow20.project 
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a># move to /tmp.
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>mv load.zip /tmp
</code></pre></div>
<p>Upload azkaban project file on <code>Flow Query Execution Node</code> where <code>Azkaban CLI</code> needs to be installed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo su - azkabancli;
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>source venv/bin/activate;
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>azkaban upload \
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>-c \
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>-p load \
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>-u azkaban:&lt;azkban-password&gt;@http://cp-1.chango.private:28081 \
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>/tmp/load.zip \
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>;
</code></pre></div>
<ul>
<li><code>&lt;azkban-password&gt;</code> is azkaban password. Default password is <code>azkaban</code>.</li>
</ul>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © <script>document.write(new Date().getFullYear())</script> Cloud Chef Labs, Inc. All rights reserved. <a href="mailto:admin@cloudchef-labs.com">admin@cloudchef-labs.com</a>
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "header.autohide"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "2.2.0", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../../javascripts/extra.js"></script>
        
      
    
  </body>
</html>